<!DOCTYPE html>

<head>
	<title>app</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>

<body>

	<div>
		<canvas id="myChart"></canvas>
	</div>
	<div>
		<canvas id="lineChart"></canvas>
	</div>
	<div>
		<input id="txtInterval" type="text" value="1000" onblur="setIntv()"/>
	</div>

	<script>
		// const ctx = document.getElementById('myChart');
		// new Chart(ctx, {
		// 	type: 'bar',
		// 	data: {
		// 		labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
		// 		datasets: [{
		// 			label: '# of votes',
		// 			data: [12,19,3,5,2,3],
		// 			borderWidth: 1
		// 		}]
		// 	},
		// 	options: {
		// 		scales: {
		// 			y: {
		// 				beginAtZero: true
		// 			}
		// 		}
		// 	}
		// });

		const ctx2 = document.getElementById('lineChart');
		const lineChart = new Chart(ctx2, {
			type: 'line',
			data: {
				//labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
				labels: [],
				datasets: [{
					label: 'CPU load',
					data: [],
					borderWidth: 1
				}]
			},
			options: {
				scales: {
					y: {
						beginAtZero: true
					}
				}
			}
		});

		var intv = setInterval(timePostBack, 1000);

        function setIntv() {
            // get the value from the txtInterval control
            var num = $("#txtInterval").val();
            // if value is an integer:
            num = parseInt(num)
            if (!isNaN(num)) {
                clearInterval(intv);
                intv = setInterval(timePostBack, num);
            }
        }

        function timePostBack() {
            //frmTime.submit();

            $.post(
                // send POST request to localhost/time with no data
                "/",
                // callback function. "data" is returned by the server
                function (data, status) {
					var d = data.split('|');
					var t = d[0];
					var y = Number.parseFloat(d[1]);

					lineChart.data.labels.push(t);
                    lineChart.data.datasets[0].data.push(y);
					lineChart.update('none');
                }
            );
        }

	</script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>